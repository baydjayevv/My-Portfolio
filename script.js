// Translations Object
const translations = {
    en: {
        nav: {
            home: "Home",
            about: "About",
            skills: "Skills",
            projects: "Projects",
            contact: "Contact"
        },
        home: {
            name: "Nurxan Baydjayev",
            subtitle: "Junior Developer — Telegram Bots & Websites",
            bio: "I started learning programming about a year ago. Since then, I've been building Telegram bots and simple websites while improving my front-end and Python skills.",
            viewGithub: "View GitHub",
            contactMe: "Contact Me"
        },
        about: {
            title: "About Me",
            para1: "I began learning programming one year ago. I enjoy solving real-world problems with code and exploring how things work behind the scenes.",
            para2: "I'm still in the early stages of my developer journey, but I'm focused on learning and growing every day.",
            para3: "I can speak English, Russian, Uzbek, and Turkmen fluently."
        },
        skills: {
            title: "Skills"
        },
        projects: {
            title: "Projects",
            text: "I don't have published projects yet, but I'm currently learning and working on my own small experiments. You can check my GitHub for updates.",
            viewGithub: "View GitHub"
        },
        contact: {
            title: "Contact Me"
        },
        footer: {
            text: "© 2025 Nurxan Baydjayev — All rights reserved."
        }
    },
    ru: {
        nav: {
            home: "Главная",
            about: "Обо мне",
            skills: "Навыки",
            projects: "Проекты",
            contact: "Контакты"
        },
        home: {
            name: "Нурхан Байджаев",
            subtitle: "Junior Разработчик — Telegram боты и веб-сайты",
            bio: "Я начал изучать программирование около года назад. С тех пор я создаю Telegram боты и простые веб-сайты, улучшая свои навыки фронтенда и Python.",
            viewGithub: "Посмотреть GitHub",
            contactMe: "Связаться со мной"
        },
        about: {
            title: "Обо мне",
            para1: "Я начал изучать программирование год назад. Мне нравится решать реальные проблемы с помощью кода и изучать, как все работает за кулисами.",
            para2: "Я все еще на раннем этапе своего пути разработчика, но я сосредоточен на обучении и росте каждый день.",
            para3: "Я свободно говорю на английском, русском, узбекском и туркменском языках."
        },
        skills: {
            title: "Навыки"
        },
        projects: {
            title: "Проекты",
            text: "У меня пока нет опубликованных проектов, но я сейчас изучаю и работаю над своими небольшими экспериментами. Вы можете проверить мой GitHub для обновлений.",
            viewGithub: "Посмотреть GitHub"
        },
        contact: {
            title: "Связаться со мной"
        },
        footer: {
            text: "© 2025 Нурхан Байджаев — Все права защищены."
        }
    },
    uz: {
        nav: {
            home: "Bosh sahifa",
            about: "Men haqimda",
            skills: "Ko'nikmalar",
            projects: "Loyihalar",
            contact: "Aloqa"
        },
        home: {
            name: "Nurxan Baydjayev",
            subtitle: "Junior Developer — Telegram botlar va veb-saytlar",
            bio: "Men dasturlashni bir yil oldin o'rganishni boshladim. O'shandan beri men Telegram botlar va oddiy veb-saytlar yaratib, frontend va Python ko'nikmalarimni yaxshilayapman.",
            viewGithub: "GitHub'ni ko'rish",
            contactMe: "Menga bog'lanish"
        },
        about: {
            title: "Men haqimda",
            para1: "Men dasturlashni bir yil oldin o'rganishni boshladim. Men kod yordamida real muammolarni hal qilishni va narsalar qanday ishlashini o'rganishni yaxshi ko'raman.",
            para2: "Men hali dasturchi yo'limning dastlabki bosqichida, lekin har kuni o'rganish va o'sishga e'tibor qarataman.",
            para3: "Men Ingliz, Rus, O'zbek va Turkman tillarida erkin gapira olaman."
        },
        skills: {
            title: "Ko'nikmalar"
        },
        projects: {
            title: "Loyihalar",
            text: "Menda hali nashr etilgan loyihalar yo'q, lekin men hozir o'rganib, o'z kichik tajribalarim ustida ishlayapman. Yangilanishlar uchun GitHub'imni tekshirishingiz mumkin.",
            viewGithub: "GitHub'ni ko'rish"
        },
        contact: {
            title: "Menga bog'lanish"
        },
        footer: {
            text: "© 2025 Nurxan Baydjayev — Barcha huquqlar himoyalangan."
        }
    },
    tm: {
        nav: {
            home: "Baş sahypa",
            about: "Men hakda",
            skills: "Ukyplar",
            projects: "Işler",
            contact: "Habarlaşyk"
        },
        home: {
            name: "Nurxan Baýdjaýew",
            subtitle: "Junior Developer — Telegram botlar we web saýtlar",
            bio: "Men programmirlemege ýakynda bir ýyl öň öwrenmäge başladyk. Şondan bäri men Telegram botlar we ýönekeý web saýtlar döretmekde, frontend we Python ukyplarymy ýokarlandyrmakda.",
            viewGithub: "GitHub gör",
            contactMe: "Meniň bilen habarlaş"
        },
        about: {
            title: "Men hakda",
            para1: "Men programmirlemege bir ýyl öň öwrenmäge başladyk. Men kod arkaly hakyky meseläni çözmek we nämäniň arka tarapynda nähili işleýändigini öwrenmek halaýaryn.",
            para2: "Men hali dasturçy ýolumaň başlangyç etapynda, ýöne her gün öwrenmek we ösmek üçin işleýärin.",
            para3: "Men Iňlis, Rus, Özbek we Türkmen dillerinde erkin gürleşýärin."
        },
        skills: {
            title: "Ukyplar"
        },
        projects: {
            title: "Işler",
            text: "Mende hali çap edilen işler ýok, ýöne men hali öwrenmekde we öz kiçi tejribelerimde işleýärin. Täzeleme üçin GitHub'ymy gözden geçirip bilersiňiz.",
            viewGithub: "GitHub gör"
        },
        contact: {
            title: "Meniň bilen habarlaş"
        },
        footer: {
            text: "© 2025 Nurxan Baýdjaýew — Ähli hukuklar goragylyk bilen saklanýar."
        }
    }
};

// Current language (default: English)
let currentLang = localStorage.getItem('language') || 'en';

// DOM Elements
const langButtons = document.querySelectorAll('.lang-btn');
const mobileMenuToggle = document.getElementById('mobileMenuToggle');
const navMenu = document.querySelector('.nav-menu');
const scrollTopBtn = document.getElementById('scrollTop');
const themeToggleBtn = document.getElementById('themeToggle');

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    initializeLanguage();
    initializeTheme(); // ensure theme is initialized from saved preference or system
    setupEventListeners();
    setupScrollAnimations();
});

// Initialize Language
function initializeLanguage() {
    // Set active language button
    langButtons.forEach(btn => {
        if (btn.dataset.lang === currentLang) {
            btn.classList.add('active');
            btn.setAttribute('aria-pressed', 'true');
        } else {
            btn.classList.remove('active');
            btn.setAttribute('aria-pressed', 'false');
        }
    });
    
    // Update all text content
    updateLanguage();
}

// Initialize Theme
function initializeTheme() {
    const saved = localStorage.getItem('theme'); // 'light' | 'dark' | null
    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

    if (saved === 'dark' || (!saved && prefersDark)) {
        document.documentElement.setAttribute('data-theme', 'dark');
        document.body.classList.add('dark');
        updateThemeIcon('dark');
    } else {
        // Explicitly set light theme attribute so it overrides system preference
        document.documentElement.setAttribute('data-theme', 'light');
        document.body.classList.remove('dark');
        updateThemeIcon('light');
    }

    // React to system changes if user hasn't set a manual preference
    const mq = window.matchMedia('(prefers-color-scheme: dark)');
    const mqHandler = (e) => {
        const savedNow = localStorage.getItem('theme');
        if (savedNow) return; // user preference wins
        const matches = (e && typeof e.matches === 'boolean') ? e.matches : mq.matches;
        if (matches) {
            document.documentElement.setAttribute('data-theme', 'dark');
            document.body.classList.add('dark');
            updateThemeIcon('dark');
        } else {
            document.documentElement.removeAttribute('data-theme');
            document.body.classList.remove('dark');
            updateThemeIcon('light');
        }
    };

    // Add listener in a backwards-compatible way
    try {
        if (mq.addEventListener) {
            mq.addEventListener('change', mqHandler);
        } else if (mq.addListener) {
            mq.addListener(mqHandler);
        }
    } catch (err) {
        // If matchMedia listeners are not supported, silently ignore.
        // We rely on initial check above to set theme.
        // console.warn('matchMedia listener not supported', err);
    }
}

function toggleTheme() {
    const isDark = document.body.classList.toggle('dark');
    if (isDark) {
        document.documentElement.setAttribute('data-theme', 'dark');
        localStorage.setItem('theme', 'dark');
        updateThemeIcon('dark');
    } else {
        // Set explicit light theme to override prefers-color-scheme
        document.documentElement.setAttribute('data-theme', 'light');
        localStorage.setItem('theme', 'light');
        updateThemeIcon('light');
    }
}

function updateThemeIcon(theme) {
    if (!themeToggleBtn) return;
    const icon = themeToggleBtn.querySelector('.theme-icon');
    if (!icon) return;
    icon.textContent = theme === 'dark' ? '🌙' : '☀️';
}

// Setup Event Listeners
function setupEventListeners() {
    // Language switcher buttons
    langButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            currentLang = btn.dataset.lang;
            localStorage.setItem('language', currentLang);
            
            // Update active state
            langButtons.forEach(b => {
                b.classList.remove('active');
                b.setAttribute('aria-pressed', 'false');
            });
            btn.classList.add('active');
            btn.setAttribute('aria-pressed', 'true');
            
            // Update language
            updateLanguage();
        });
    });

    // Mobile menu toggle
    mobileMenuToggle.addEventListener('click', () => {
        navMenu.classList.toggle('active');
    });

    // Close mobile menu when clicking nav links
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', () => {
            navMenu.classList.remove('active');
        });
    });

    // Smooth scroll for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });

    // Theme toggle button
    if (themeToggleBtn) {
        themeToggleBtn.addEventListener('click', toggleTheme);
    }

    // Scroll to top button
    scrollTopBtn.addEventListener('click', () => {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    });

    // Show/hide scroll to top button
    window.addEventListener('scroll', () => {
        if (window.pageYOffset > 300) {
            scrollTopBtn.classList.add('visible');
        } else {
            scrollTopBtn.classList.remove('visible');
        }
    });
}

// Update Language
function updateLanguage() {
    const t = translations[currentLang];
    
    // Update navigation
    document.querySelectorAll('[data-translate^="nav."]').forEach(el => {
        const key = el.dataset.translate.replace('nav.', '');
        el.textContent = t.nav[key];
    });

    // Update home section
    const homeKeys = ['name', 'subtitle', 'bio', 'viewGithub', 'contactMe'];
    document.querySelectorAll('[data-translate^="home."]').forEach(el => {
        const key = el.dataset.translate.replace('home.', '');
        if (homeKeys.includes(key)) {
            el.textContent = t.home[key];
        }
    });

    // Update about section
    document.querySelector('[data-translate="about.title"]').textContent = t.about.title;
    document.querySelector('[data-translate="about.para1"]').textContent = t.about.para1;
    document.querySelector('[data-translate="about.para2"]').textContent = t.about.para2;
    document.querySelector('[data-translate="about.para3"]').textContent = t.about.para3;

    // Update skills section
    document.querySelector('[data-translate="skills.title"]').textContent = t.skills.title;

    // Update projects section
    document.querySelector('[data-translate="projects.title"]').textContent = t.projects.title;
    document.querySelector('[data-translate="projects.text"]').textContent = t.projects.text;
    document.querySelectorAll('[data-translate="projects.viewGithub"]').forEach(el => {
        el.textContent = t.projects.viewGithub;
    });

    // Update contact section
    document.querySelector('[data-translate="contact.title"]').textContent = t.contact.title;

    // Update footer
    document.querySelector('[data-translate="footer.text"]').textContent = t.footer.text;
}

// Scroll Animations
function setupScrollAnimations() {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    // Observe all sections
    document.querySelectorAll('section').forEach(section => {
        section.style.opacity = '0';
        section.style.transform = 'translateY(30px)';
        section.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(section);
    });
}

// Header scroll effect
window.addEventListener('scroll', () => {
    const header = document.querySelector('.header');
    if (window.pageYOffset > 50) {
        header.style.boxShadow = '0 5px 20px rgba(0, 0, 0, 0.1)';
    } else {
        header.style.boxShadow = '0 2px 10px rgba(0, 0, 0, 0.08)';
    }
});