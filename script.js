// Translations Object
const translations = {
    en: {
        nav: {
            home: "Home",
            about: "About",
            skills: "Skills",
            projects: "Projects",
            contact: "Contact"
        },
        home: {
            name: "Nurxan Baydjayev",
            subtitle: "Junior Developer â€” Telegram Bots & Websites",
            bio: "I started learning programming about a year ago. Since then, I've been building Telegram bots and simple websites while improving my front-end and Python skills.",
            viewGithub: "View GitHub",
            contactMe: "Contact Me"
        },
        about: {
            title: "About Me",
            para1: "I began learning programming one year ago. I enjoy solving real-world problems with code and exploring how things work behind the scenes.",
            para2: "I'm still in the early stages of my developer journey, but I'm focused on learning and growing every day.",
            para3: "I can speak English, Russian, Uzbek, and Turkmen fluently."
        },
        skills: {
            title: "Skills"
        },
        projects: {
            title: "Projects",
            text: "I don't have published projects yet, but I'm currently learning and working on my own small experiments. You can check my GitHub for updates.",
            viewGithub: "View GitHub"
        },
        contact: {
            title: "Contact Me"
        },
        footer: {
            text: "Â© 2025 Nurxan Baydjayev â€” All rights reserved."
        }
    },
    ru: {
        nav: {
            home: "Ð“Ð»Ð°Ð²Ð½Ð°Ñ",
            about: "ÐžÐ±Ð¾ Ð¼Ð½Ðµ",
            skills: "ÐÐ°Ð²Ñ‹ÐºÐ¸",
            projects: "ÐŸÑ€Ð¾ÐµÐºÑ‚Ñ‹",
            contact: "ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ñ‹"
        },
        home: {
            name: "ÐÑƒÑ€Ñ…Ð°Ð½ Ð‘Ð°Ð¹Ð´Ð¶Ð°ÐµÐ²",
            subtitle: "Junior Ð Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº â€” Telegram Ð±Ð¾Ñ‚Ñ‹ Ð¸ Ð²ÐµÐ±-ÑÐ°Ð¹Ñ‚Ñ‹",
            bio: "Ð¯ Ð½Ð°Ñ‡Ð°Ð» Ð¸Ð·ÑƒÑ‡Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¾ÐºÐ¾Ð»Ð¾ Ð³Ð¾Ð´Ð° Ð½Ð°Ð·Ð°Ð´. Ð¡ Ñ‚ÐµÑ… Ð¿Ð¾Ñ€ Ñ ÑÐ¾Ð·Ð´Ð°ÑŽ Telegram Ð±Ð¾Ñ‚Ñ‹ Ð¸ Ð¿Ñ€Ð¾ÑÑ‚Ñ‹Ðµ Ð²ÐµÐ±-ÑÐ°Ð¹Ñ‚Ñ‹, ÑƒÐ»ÑƒÑ‡ÑˆÐ°Ñ ÑÐ²Ð¾Ð¸ Ð½Ð°Ð²Ñ‹ÐºÐ¸ Ñ„Ñ€Ð¾Ð½Ñ‚ÐµÐ½Ð´Ð° Ð¸ Python.",
            viewGithub: "ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ GitHub",
            contactMe: "Ð¡Ð²ÑÐ·Ð°Ñ‚ÑŒÑÑ ÑÐ¾ Ð¼Ð½Ð¾Ð¹"
        },
        about: {
            title: "ÐžÐ±Ð¾ Ð¼Ð½Ðµ",
            para1: "Ð¯ Ð½Ð°Ñ‡Ð°Ð» Ð¸Ð·ÑƒÑ‡Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð³Ð¾Ð´ Ð½Ð°Ð·Ð°Ð´. ÐœÐ½Ðµ Ð½Ñ€Ð°Ð²Ð¸Ñ‚ÑÑ Ñ€ÐµÑˆÐ°Ñ‚ÑŒ Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ ÐºÐ¾Ð´Ð° Ð¸ Ð¸Ð·ÑƒÑ‡Ð°Ñ‚ÑŒ, ÐºÐ°Ðº Ð²ÑÐµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð·Ð° ÐºÑƒÐ»Ð¸ÑÐ°Ð¼Ð¸.",
            para2: "Ð¯ Ð²ÑÐµ ÐµÑ‰Ðµ Ð½Ð° Ñ€Ð°Ð½Ð½ÐµÐ¼ ÑÑ‚Ð°Ð¿Ðµ ÑÐ²Ð¾ÐµÐ³Ð¾ Ð¿ÑƒÑ‚Ð¸ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ°, Ð½Ð¾ Ñ ÑÐ¾ÑÑ€ÐµÐ´Ð¾Ñ‚Ð¾Ñ‡ÐµÐ½ Ð½Ð° Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð¸Ð¸ Ð¸ Ñ€Ð¾ÑÑ‚Ðµ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ.",
            para3: "Ð¯ ÑÐ²Ð¾Ð±Ð¾Ð´Ð½Ð¾ Ð³Ð¾Ð²Ð¾Ñ€ÑŽ Ð½Ð° Ð°Ð½Ð³Ð»Ð¸Ð¹ÑÐºÐ¾Ð¼, Ñ€ÑƒÑÑÐºÐ¾Ð¼, ÑƒÐ·Ð±ÐµÐºÑÐºÐ¾Ð¼ Ð¸ Ñ‚ÑƒÑ€ÐºÐ¼ÐµÐ½ÑÐºÐ¾Ð¼ ÑÐ·Ñ‹ÐºÐ°Ñ…."
        },
        skills: {
            title: "ÐÐ°Ð²Ñ‹ÐºÐ¸"
        },
        projects: {
            title: "ÐŸÑ€Ð¾ÐµÐºÑ‚Ñ‹",
            text: "Ð£ Ð¼ÐµÐ½Ñ Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚ Ð¾Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð², Ð½Ð¾ Ñ ÑÐµÐ¹Ñ‡Ð°Ñ Ð¸Ð·ÑƒÑ‡Ð°ÑŽ Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽ Ð½Ð°Ð´ ÑÐ²Ð¾Ð¸Ð¼Ð¸ Ð½ÐµÐ±Ð¾Ð»ÑŒÑˆÐ¸Ð¼Ð¸ ÑÐºÑÐ¿ÐµÑ€Ð¸Ð¼ÐµÐ½Ñ‚Ð°Ð¼Ð¸. Ð’Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð¼Ð¾Ð¹ GitHub Ð´Ð»Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹.",
            viewGithub: "ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ GitHub"
        },
        contact: {
            title: "Ð¡Ð²ÑÐ·Ð°Ñ‚ÑŒÑÑ ÑÐ¾ Ð¼Ð½Ð¾Ð¹"
        },
        footer: {
            text: "Â© 2025 ÐÑƒÑ€Ñ…Ð°Ð½ Ð‘Ð°Ð¹Ð´Ð¶Ð°ÐµÐ² â€” Ð’ÑÐµ Ð¿Ñ€Ð°Ð²Ð° Ð·Ð°Ñ‰Ð¸Ñ‰ÐµÐ½Ñ‹."
        }
    },
    uz: {
        nav: {
            home: "Bosh sahifa",
            about: "Men haqimda",
            skills: "Ko'nikmalar",
            projects: "Loyihalar",
            contact: "Aloqa"
        },
        home: {
            name: "Nurxan Baydjayev",
            subtitle: "Junior Developer â€” Telegram botlar va veb-saytlar",
            bio: "Men dasturlashni bir yil oldin o'rganishni boshladim. O'shandan beri men Telegram botlar va oddiy veb-saytlar yaratib, frontend va Python ko'nikmalarimni yaxshilayapman.",
            viewGithub: "GitHub'ni ko'rish",
            contactMe: "Menga bog'lanish"
        },
        about: {
            title: "Men haqimda",
            para1: "Men dasturlashni bir yil oldin o'rganishni boshladim. Men kod yordamida real muammolarni hal qilishni va narsalar qanday ishlashini o'rganishni yaxshi ko'raman.",
            para2: "Men hali dasturchi yo'limning dastlabki bosqichida, lekin har kuni o'rganish va o'sishga e'tibor qarataman.",
            para3: "Men Ingliz, Rus, O'zbek va Turkman tillarida erkin gapira olaman."
        },
        skills: {
            title: "Ko'nikmalar"
        },
        projects: {
            title: "Loyihalar",
            text: "Menda hali nashr etilgan loyihalar yo'q, lekin men hozir o'rganib, o'z kichik tajribalarim ustida ishlayapman. Yangilanishlar uchun GitHub'imni tekshirishingiz mumkin.",
            viewGithub: "GitHub'ni ko'rish"
        },
        contact: {
            title: "Menga bog'lanish"
        },
        footer: {
            text: "Â© 2025 Nurxan Baydjayev â€” Barcha huquqlar himoyalangan."
        }
    },
    tm: {
        nav: {
            home: "BaÅŸ sahypa",
            about: "Men hakda",
            skills: "Ukyplar",
            projects: "IÅŸler",
            contact: "HabarlaÅŸyk"
        },
        home: {
            name: "Nurxan BaÃ½djaÃ½ew",
            subtitle: "Junior Developer â€” Telegram botlar we web saÃ½tlar",
            bio: "Men programmirlemege Ã½akynda bir Ã½yl Ã¶Åˆ Ã¶wrenmÃ¤ge baÅŸladyk. Åžondan bÃ¤ri men Telegram botlar we Ã½Ã¶nekeÃ½ web saÃ½tlar dÃ¶retmekde, frontend we Python ukyplarymy Ã½okarlandyrmakda.",
            viewGithub: "GitHub gÃ¶r",
            contactMe: "MeniÅˆ bilen habarlaÅŸ"
        },
        about: {
            title: "Men hakda",
            para1: "Men programmirlemege bir Ã½yl Ã¶Åˆ Ã¶wrenmÃ¤ge baÅŸladyk. Men kod arkaly hakyky meselÃ¤ni Ã§Ã¶zmek we nÃ¤mÃ¤niÅˆ arka tarapynda nÃ¤hili iÅŸleÃ½Ã¤ndigini Ã¶wrenmek halaÃ½aryn.",
            para2: "Men hali dasturÃ§y Ã½olumaÅˆ baÅŸlangyÃ§ etapynda, Ã½Ã¶ne her gÃ¼n Ã¶wrenmek we Ã¶smek Ã¼Ã§in iÅŸleÃ½Ã¤rin.",
            para3: "Men IÅˆlis, Rus, Ã–zbek we TÃ¼rkmen dillerinde erkin gÃ¼rleÅŸÃ½Ã¤rin."
        },
        skills: {
            title: "Ukyplar"
        },
        projects: {
            title: "IÅŸler",
            text: "Mende hali Ã§ap edilen iÅŸler Ã½ok, Ã½Ã¶ne men hali Ã¶wrenmekde we Ã¶z kiÃ§i tejribelerimde iÅŸleÃ½Ã¤rin. TÃ¤zeleme Ã¼Ã§in GitHub'ymy gÃ¶zden geÃ§irip bilersiÅˆiz.",
            viewGithub: "GitHub gÃ¶r"
        },
        contact: {
            title: "MeniÅˆ bilen habarlaÅŸ"
        },
        footer: {
            text: "Â© 2025 Nurxan BaÃ½djaÃ½ew â€” Ã„hli hukuklar goragylyk bilen saklanÃ½ar."
        }
    }
};

// Current language (default: English)
let currentLang = localStorage.getItem('language') || 'en';

// DOM Elements
const langButtons = document.querySelectorAll('.lang-btn');
const mobileMenuToggle = document.getElementById('mobileMenuToggle');
const navMenu = document.querySelector('.nav-menu');
const scrollTopBtn = document.getElementById('scrollTop');
const themeToggleBtn = document.getElementById('themeToggle');

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    initializeLanguage();
    initializeTheme(); // ensure theme is initialized from saved preference or system
    setupEventListeners();
    setupScrollAnimations();
});

// Initialize Language
function initializeLanguage() {
    // Set active language button
    langButtons.forEach(btn => {
        if (btn.dataset.lang === currentLang) {
            btn.classList.add('active');
            btn.setAttribute('aria-pressed', 'true');
        } else {
            btn.classList.remove('active');
            btn.setAttribute('aria-pressed', 'false');
        }
    });
    
    // Update all text content
    updateLanguage();
}

// Initialize Theme
function initializeTheme() {
    const saved = localStorage.getItem('theme'); // 'light' | 'dark' | null
    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

    if (saved === 'dark' || (!saved && prefersDark)) {
        document.documentElement.setAttribute('data-theme', 'dark');
        document.body.classList.add('dark');
        updateThemeIcon('dark');
    } else {
        // Explicitly set light theme attribute so it overrides system preference
        document.documentElement.setAttribute('data-theme', 'light');
        document.body.classList.remove('dark');
        updateThemeIcon('light');
    }

    // React to system changes if user hasn't set a manual preference
    const mq = window.matchMedia('(prefers-color-scheme: dark)');
    const mqHandler = (e) => {
        const savedNow = localStorage.getItem('theme');
        if (savedNow) return; // user preference wins
        const matches = (e && typeof e.matches === 'boolean') ? e.matches : mq.matches;
        if (matches) {
            document.documentElement.setAttribute('data-theme', 'dark');
            document.body.classList.add('dark');
            updateThemeIcon('dark');
        } else {
            document.documentElement.removeAttribute('data-theme');
            document.body.classList.remove('dark');
            updateThemeIcon('light');
        }
    };

    // Add listener in a backwards-compatible way
    try {
        if (mq.addEventListener) {
            mq.addEventListener('change', mqHandler);
        } else if (mq.addListener) {
            mq.addListener(mqHandler);
        }
    } catch (err) {
        // If matchMedia listeners are not supported, silently ignore.
        // We rely on initial check above to set theme.
        // console.warn('matchMedia listener not supported', err);
    }
}

function toggleTheme() {
    const isDark = document.body.classList.toggle('dark');
    if (isDark) {
        document.documentElement.setAttribute('data-theme', 'dark');
        localStorage.setItem('theme', 'dark');
        updateThemeIcon('dark');
    } else {
        // Set explicit light theme to override prefers-color-scheme
        document.documentElement.setAttribute('data-theme', 'light');
        localStorage.setItem('theme', 'light');
        updateThemeIcon('light');
    }
}

function updateThemeIcon(theme) {
    if (!themeToggleBtn) return;
    const icon = themeToggleBtn.querySelector('.theme-icon');
    if (!icon) return;
    icon.textContent = theme === 'dark' ? 'ðŸŒ™' : 'â˜€ï¸';
}

// Setup Event Listeners
function setupEventListeners() {
    // Language switcher buttons
    langButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            currentLang = btn.dataset.lang;
            localStorage.setItem('language', currentLang);
            
            // Update active state
            langButtons.forEach(b => {
                b.classList.remove('active');
                b.setAttribute('aria-pressed', 'false');
            });
            btn.classList.add('active');
            btn.setAttribute('aria-pressed', 'true');
            
            // Update language
            updateLanguage();
        });
    });

    // Mobile menu toggle
    mobileMenuToggle.addEventListener('click', () => {
        navMenu.classList.toggle('active');
    });

    // Close mobile menu when clicking nav links
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', () => {
            navMenu.classList.remove('active');
        });
    });

    // Smooth scroll for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });

    // Theme toggle button
    if (themeToggleBtn) {
        themeToggleBtn.addEventListener('click', toggleTheme);
    }

    // Scroll to top button
    scrollTopBtn.addEventListener('click', () => {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    });

    // Show/hide scroll to top button
    window.addEventListener('scroll', () => {
        if (window.pageYOffset > 300) {
            scrollTopBtn.classList.add('visible');
        } else {
            scrollTopBtn.classList.remove('visible');
        }
    });
}

// Update Language
function updateLanguage() {
    const t = translations[currentLang];
    
    // Update navigation
    document.querySelectorAll('[data-translate^="nav."]').forEach(el => {
        const key = el.dataset.translate.replace('nav.', '');
        el.textContent = t.nav[key];
    });

    // Update home section
    const homeKeys = ['name', 'subtitle', 'bio', 'viewGithub', 'contactMe'];
    document.querySelectorAll('[data-translate^="home."]').forEach(el => {
        const key = el.dataset.translate.replace('home.', '');
        if (homeKeys.includes(key)) {
            el.textContent = t.home[key];
        }
    });

    // Update about section
    document.querySelector('[data-translate="about.title"]').textContent = t.about.title;
    document.querySelector('[data-translate="about.para1"]').textContent = t.about.para1;
    document.querySelector('[data-translate="about.para2"]').textContent = t.about.para2;
    document.querySelector('[data-translate="about.para3"]').textContent = t.about.para3;

    // Update skills section
    document.querySelector('[data-translate="skills.title"]').textContent = t.skills.title;

    // Update projects section
    document.querySelector('[data-translate="projects.title"]').textContent = t.projects.title;
    document.querySelector('[data-translate="projects.text"]').textContent = t.projects.text;
    document.querySelectorAll('[data-translate="projects.viewGithub"]').forEach(el => {
        el.textContent = t.projects.viewGithub;
    });

    // Update contact section
    document.querySelector('[data-translate="contact.title"]').textContent = t.contact.title;

    // Update footer
    document.querySelector('[data-translate="footer.text"]').textContent = t.footer.text;
}

// Scroll Animations
function setupScrollAnimations() {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    // Observe all sections
    document.querySelectorAll('section').forEach(section => {
        section.style.opacity = '0';
        section.style.transform = 'translateY(30px)';
        section.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(section);
    });
}

// Header scroll effect
window.addEventListener('scroll', () => {
    const header = document.querySelector('.header');
    if (window.pageYOffset > 50) {
        header.style.boxShadow = '0 5px 20px rgba(0, 0, 0, 0.1)';
    } else {
        header.style.boxShadow = '0 2px 10px rgba(0, 0, 0, 0.08)';
    }
});